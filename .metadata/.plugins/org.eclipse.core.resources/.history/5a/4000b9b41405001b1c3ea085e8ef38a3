package board;

import java.util.ArrayList;

public class Spot {
	public Piece piece;
	public Cord cord;
	public Board board;
	public ArrayList<Piece> possiblePieces = new ArrayList<Piece>();
	
	public Spot(int givenRow, int givenColumn, Board giveBoard) {
		cord = new Cord(givenRow, givenColumn);
		board = giveBoard;
	}
	
	public void setPiece(Piece GivenPiece) {
		piece = GivenPiece;
	}
	
	private void enPassant(Spot next) {
		if(piece.getType()==PieceType.PAWN) {
			if(((Pawn) piece).enPassant(next)) {
				Piece temp = new Empty(next.piece.clone(this));
				Piece temp1 = piece.clone(next);
				next.piece.delete();
				piece.removeMoves();
				next.piece = temp1;
				piece = temp;
				
				board.getPiece(cord.row+piece.player.DIRECTION, cord.column).enPassant = null;
				piece.player.enPassant = null;
			}
		}
	}
	
	private void doubleMove(Spot next) {
		if(piece.getType()==PieceType.PAWN) {
			if(((Pawn) piece).doubleMove(next)) {
				board.getPiece(cord.row+piece.player.DIRECTION, cord.column).enPassant = (Pawn) piece;
				piece.player.enPassant = (Empty) board.getPiece(cord.row+piece.player.DIRECTION, cord.column);
				Piece temp = next.piece.clone(this);
				Piece temp1 = piece.clone(next);
				next.piece.removeMoves();
				piece.removeMoves();
				next.piece = temp1;
				piece = temp;
			}
		}
	}
	
	public boolean movePiece(Spot next) {
			doubleMove(next);
			enPassant(next);
		
		piece.addMoves();
		if(next.possiblePieces.contains(piece)) {
			if(next.piece.getType()==PieceType.EMPTY) {
				Piece temp = next.piece.clone(this);
				Piece temp1 = piece.clone(next);
				next.piece.removeMoves();
				piece.removeMoves();
				next.piece = temp1;
				piece = temp;
			}
			else if(next.piece.player!=piece.player) {//already checked
				Piece temp = new Empty(next.piece.clone(this));
				Piece temp1 = piece.clone(next);
				next.piece.delete();
				piece.removeMoves();
				next.piece = temp1;
				piece = temp;
			}
		}
		else {
			return false;
		}
		return true;
	}
	
	public void movePiece(String givenStringCord) {
		movePiece(board.getSpot(new Cord(givenStringCord)));
	}
}
